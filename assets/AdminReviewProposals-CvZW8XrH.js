import{A as P,m as T,_ as m,o as i,c as d,a as t,t as y,z as C,S as D,g as S,u as E,B as U,p as v,k as x,b as B,F as c,r as u,d as b,j as g}from"./index-krZDK7h8.js";import{m as I}from"./mixinSwalToast--x5wgD_K.js";import{m as w}from"./mixinFullScreenLoading-9dNja2ki.js";const M=P("adminStore",{state:()=>({denyProposalData:"",name:"adminStore"}),getters:{getUserName:e=>`傳出的內容為${e.name}`},actions:{updateDenyModalData(e){this.denyProposalData=e}}}),L={props:["proposalData"],data(){return{}},methods:{...T(M,["updateDenyModalData"]),emitActive(){this.$emit("emitActive",this.proposalData.proposalID,this.proposalData.proposalTitle)},emitDeny(){this.updateDenyModalData(this.proposalData),this.$emit("emitDeny")}}},V={class:"card bg-transparent border-0"},R={class:"card-body bg-transparent py-2 px-3 py-md-3 px-md-6 px-lg-8 border rounded d-flex justify-content-between align-items-center"},F={class:"w-100 row align-items-center g-0"},O={class:"col-12 col-sm-7"},j={class:"d-flex align-items-center"},A=["src"],J={class:"flex-grow-1 text-white text-truncate"},N={class:"mb-0 fs-14 fs-md-5 text-truncate"},Y={class:"col-12 col-sm-5"},W={key:0,class:"d-flex justify-content-sm-end align-items-center"},z=t("button",{class:"btn btn-outline-dark-pr px-2 px-md-4 px-lg-6"},"查看",-1),G={key:1,class:"d-flex justify-content-end align-items-center"},Q=t("p",{class:"mb-0 text-secondary-light"},"審查通過",-1),X=["href"];function Z(e,s,a,h,l,o){return i(),d("div",V,[t("div",R,[t("div",F,[t("div",O,[t("div",j,[t("img",{src:a.proposalData.proposalMainImage,alt:"",class:"object-fit-cover rounded-pill me-2 me-md-4 me-lg-8",width:"48",height:"48"},null,8,A),t("div",J,[t("p",N,y(a.proposalData.proposalTitle),1)])])]),t("div",Y,[a.proposalData.proposalStatus==="review"?(i(),d("div",W,[z,t("button",{class:"btn btn-outline-dark-pr px-2 px-md-4 px-lg-6 ms-1 ms-sm-2 ms-md-4",onClick:s[0]||(s[0]=(...n)=>o.emitActive&&o.emitActive(...n))},"通過"),t("button",{class:"btn btn-outline-dark-pr px-2 px-md-4 px-lg-6 ms-1 ms-sm-2 ms-md-4",onClick:s[1]||(s[1]=(...n)=>o.emitDeny&&o.emitDeny(...n))},"退回")])):a.proposalData.proposalStatus==="active"?(i(),d("div",G,[Q,t("a",{class:"btn btn-outline-dark-pr px-2 px-md-4 px-lg-6 ms-1 ms-sm-2 ms-md-4",href:`/#/product/${a.proposalData.proposalID}/info`,target:"_blank"},"查看",8,X)])):C("",!0)])])])])}const q=m(L,[["render",Z]]);var H={VITE_URL:"https://api-dreamboost.vercel.app",VITE_WEIKEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3RlbWFpbEBnbWFpbC5jb20iLCJ1c2VySUQiOiIzYTU4MjBhZi1iN2JlLTRkODMtOWM2My1kNmY1MWI2YmExMDEiLCJpYXQiOjE3MDg5Mzk5MDcsImV4cCI6MTcxMTUzMTkwN30.BbIXGVkQOU2HqsiCg6UcwFZx-kBd7kdOP24kUD21c1M",BASE_URL:"/DreamBoost/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f}=H,K={data(){return{modalInstance:"",denyMessages:""}},methods:{show(){this.denyMessages="",this.modalInstance.show()},hide(){this.modalInstance.hide()},doubleCheck(){D.fire({title:"確定要退回提案嗎？",icon:"question",allowOutsideClick:!1,showCancelButton:!0,buttonsStyling:!0,confirmButtonText:"確認",cancelButtonText:"取消"}).then(e=>{e.isConfirmed&&this.denyProposal(),e.isDismissed}).catch(()=>{this.addToast({content:"退回提案過程出現錯誤",style:"error"})})},denyProposal(){this.showFullScreenLoading(),Promise.all([this.$http.post(`${f}/dreamboost/proposal/admin/changeToDraft`,{proposalID:this.denyProposalData.proposalID}),this.$http.post(`${f}/dreamboost/message/admin/message`,{messageToUserID:`${this.denyProposalData.proposalByUserID}`,messageTitle:"提案審核失敗",messageContent:`退回原因：${this.denyMessages}`,messageTime:new Date().getTime()})]).then(()=>{this.hideFullScreenLoading(),this.addToast({content:"已經提案退回",style:"info"}),this.hide(),this.$emit("updateProposalDatas")}).catch(()=>{this.hideFullScreenLoading(),this.addToast({content:"退回提案過程出現錯誤，請聯繫工程師",style:"error"})})}},mounted(){this.modalInstance=new this.$bs.Modal(this.$refs.modalInstance,{focus:!1})},computed:{...S(M,["denyProposalData"])},components:{},watch:{},mixins:[I,w]},tt=e=>(v("data-v-1bcd4a9a"),e=e(),x(),e),et={class:"modal fade",ref:"modalInstance","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",style:{"background-color":"rgba(11, 17, 28, 0.6)"}},st={class:"modal-dialog modal-lg modal-dialog-centered"},ot={class:"modal-content bg-gray-700 border border-light"},at={class:"modal-header border-bottom-0"},nt={class:"modal-body"},it=tt(()=>t("div",{class:"border-bottom"},[t("h2",{class:"mb-4 text-white fw-nromal text-center"},"退回專案"),t("p",{class:"mb-8 text-dark-pr text-center fs-18"},"請輸入退回原因")],-1)),dt={class:"mt-12 px-10"},lt={class:"card bg-transparent border-0"},rt={class:"card-body bg-transparent pt-3 pb-6 ps-8 pe-3 border-gray-500 border-bottom d-flex justify-content-between"},ct={class:"d-flex"},pt=["src"],mt={class:"d-flex flex-column justify-content-center text-white"},ht={class:"mb-0"},_t={class:"modal-footer border-top-0"};function ut(e,s,a,h,l,o){return i(),d("div",et,[t("div",st,[t("div",ot,[t("div",at,[t("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:s[0]||(s[0]=(...n)=>o.hide&&o.hide(...n))})]),t("div",nt,[it,t("div",dt,[t("div",lt,[t("div",rt,[t("div",ct,[t("img",{src:e.denyProposalData.proposalMainImage,alt:"主要圖片",class:"rounded-pill me-10",width:"48",height:"48"},null,8,pt),t("div",mt,[t("p",ht,y(e.denyProposalData.proposalTitle),1)])])])]),E(t("textarea",{class:"form-control bg-transparent text-white mt-16",placeholder:"輸入退回原因",id:"",style:{height:"150px"},"onUpdate:modelValue":s[1]||(s[1]=n=>l.denyMessages=n)},null,512),[[U,l.denyMessages]])])]),t("div",_t,[t("button",{type:"button",class:"btn btn-dark-pr py-3 px-16",onClick:s[2]||(s[2]=(...n)=>o.doubleCheck&&o.doubleCheck(...n))},"儲存並關閉")])])])],512)}const bt=m(K,[["render",ut],["__scopeId","data-v-1bcd4a9a"]]);var gt={VITE_URL:"https://api-dreamboost.vercel.app",VITE_WEIKEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3RlbWFpbEBnbWFpbC5jb20iLCJ1c2VySUQiOiIzYTU4MjBhZi1iN2JlLTRkODMtOWM2My1kNmY1MWI2YmExMDEiLCJpYXQiOjE3MDg5Mzk5MDcsImV4cCI6MTcxMTUzMTkwN30.BbIXGVkQOU2HqsiCg6UcwFZx-kBd7kdOP24kUD21c1M",BASE_URL:"/DreamBoost/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:p}=gt,ft={data(){return{reviewProposals:[],activeProposals:[]}},methods:{showDenyProposalModal(){this.$refs.proposalModal.show()},getDatas(){this.showFullScreenLoading({canCancel:!1,loader:"dots"}),Promise.all([this.$http.get(`${p}/dreamboost/proposal/admin/inReviewProposals`),this.$http.get(`${p}/dreamboost/proposal/guest/inActiveProposals`)]).then(e=>{this.reviewProposals=e[0].data.data.result,this.activeProposals=e[1].data.data.result,this.addToast({content:"提案資料取得完畢"}),this.hideFullScreenLoading()}).catch(()=>{this.addToast({content:"取得API資料過程出現錯誤，請嘗試重新整理畫面再次取得。",style:"error"}),this.hideFullScreenLoading()})},activateProposal(e,s){D.fire({title:"確認審核？",text:`${s}`,footer:"注意，一旦審核通過即不可再修改狀態了。",icon:"question",allowOutsideClick:!1,showCancelButton:!0,buttonsStyling:!0,confirmButtonText:"確認",cancelButtonText:"取消"}).then(a=>a.isConfirmed?(this.showFullScreenLoading(),this.$http.post(`${p}/dreamboost/proposal/admin/changeToActive`,{proposalID:e})):a.isDismissed?Promise.reject(new Error("User cancelled")):Promise.reject(new Error("其他錯誤狀況"))).then(()=>{this.hideFullScreenLoading(),this.addToast({content:`${s} 已上架完成`}),this.getDatas()}).catch(a=>{this.hideFullScreenLoading(),a.message!=="User cancelled"&&this.addToast({content:"審核過程出現錯誤，請重新整理後再次操作。如果重複出現此提示請洽工程師。",style:"error"})})}},components:{ProposalCard:q,ProposalModal:bt},mounted(){this.getDatas()},watched:{},mixins:[w,I]},k=e=>(v("data-v-cd942516"),e=e(),x(),e),yt={class:"container"},Dt={class:"row justify-content-center"},vt={class:"col-12 col-lg-10"},xt=k(()=>t("div",{class:"d-flex mb-4"},[t("p",{class:"mb-0 fs-3 text-white mt-19"},"待審查方案")],-1)),It={class:"l-CardGapY"},wt={class:"row justify-content-center"},Mt={class:"col-12 col-lg-10"},kt=k(()=>t("div",{class:"d-flex mb-4"},[t("p",{class:"mb-0 fs-3 text-white mt-19"},"審查成功方案")],-1)),$t={class:"l-CardGapY"};function Pt(e,s,a,h,l,o){const n=b("ProposalModal"),_=b("ProposalCard");return i(),d(c,null,[B(n,{ref:"proposalModal",onUpdateProposalDatas:o.getDatas},null,8,["onUpdateProposalDatas"]),t("div",yt,[t("div",Dt,[t("div",vt,[xt,t("div",It,[(i(!0),d(c,null,u(l.reviewProposals,r=>(i(),g(_,{"proposal-data":r,key:r.proposalID,onEmitActive:o.activateProposal,onEmitDeny:o.showDenyProposalModal},null,8,["proposal-data","onEmitActive","onEmitDeny"]))),128))])])]),t("div",wt,[t("div",Mt,[kt,t("div",$t,[(i(!0),d(c,null,u(l.activeProposals,(r,$)=>(i(),g(_,{"proposal-data":r,key:`${$}-list`},null,8,["proposal-data"]))),128))])])])])],64)}const Et=m(ft,[["render",Pt],["__scopeId","data-v-cd942516"]]);export{Et as default};
