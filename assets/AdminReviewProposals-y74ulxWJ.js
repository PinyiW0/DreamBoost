import{l as P,n as T,_ as m,o as i,c as l,a as t,t as C,x as S,S as y,m as E,s as U,y as L,p as D,j as x,b as B,F as c,d as u,r as b,i as g}from"./index-2h2Iffh6.js";import{M as v}from"./mixinSwalToast-09aUehCB.js";import{M as I}from"./mixinFullScreenLoading-S7MBERzv.js";const M=P("adminStore",{state:()=>({denyProposalData:"",name:"adminStore"}),getters:{getUserName:s=>`傳出的內容為${s.name}`},actions:{updateDenyModalData(s){this.denyProposalData=s}}}),V={props:["proposalData"],data(){return{}},methods:{...T(M,["updateDenyModalData"]),emitActive(){this.$emit("emitActive",this.proposalData.proposalID,this.proposalData.proposalTitle)},emitDeny(){this.updateDenyModalData(this.proposalData),this.$emit("emitDeny")}}},R={class:"card bg-transparent border-0"},F={class:"card-body bg-transparent py-2 px-3 py-md-3 px-md-6 px-lg-8 border rounded d-flex justify-content-between align-items-center"},O={class:"w-100 row align-items-center g-0"},j={class:"col-12 col-sm-7"},J={class:"d-flex align-items-center"},A=["src"],N={class:"flex-grow-1 text-white text-truncate"},Y=t("p",{class:"mb-0 fs-12 lh-sm mb-1"},"2024.02.13",-1),W={class:"mb-0 fs-14 fs-md-5 text-truncate"},z={class:"col-12 col-sm-5"},G={key:0,class:"d-flex justify-content-sm-end align-items-center"},Q=t("button",{class:"btn btn-outline-dark-pr px-2 px-md-4 px-lg-6"},"查看",-1),X={key:1,class:"d-flex justify-content-end align-items-center"},Z=t("p",{class:"mb-0 text-secondary-light"},"審查通過",-1),q=t("button",{class:"btn btn-outline-dark-pr px-2 px-md-4 px-lg-6 ms-1 ms-sm-2 ms-md-4"},"查看",-1),H=[Z,q];function K(s,e,a,h,d,o){return i(),l("div",R,[t("div",F,[t("div",O,[t("div",j,[t("div",J,[t("img",{src:a.proposalData.proposalMainImage,alt:"",class:"rounded-pill me-2 me-md-4 me-lg-8",width:"48",height:"48"},null,8,A),t("div",N,[Y,t("p",W,C(a.proposalData.proposalTitle),1)])])]),t("div",z,[a.proposalData.proposalStatus==="review"?(i(),l("div",G,[Q,t("button",{class:"btn btn-outline-dark-pr px-2 px-md-4 px-lg-6 ms-1 ms-sm-2 ms-md-4",onClick:e[0]||(e[0]=(...n)=>o.emitActive&&o.emitActive(...n))},"通過"),t("button",{class:"btn btn-outline-dark-pr px-2 px-md-4 px-lg-6 ms-1 ms-sm-2 ms-md-4",onClick:e[1]||(e[1]=(...n)=>o.emitDeny&&o.emitDeny(...n))},"退回")])):a.proposalData.proposalStatus==="active"?(i(),l("div",X,H)):S("",!0)])])])])}const tt=m(V,[["render",K]]);var st={VITE_URL:"https://api.dreamboost.shop",VITE_WEIKEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3RlbWFpbEBnbWFpbC5jb20iLCJ1c2VySUQiOiIzYTU4MjBhZi1iN2JlLTRkODMtOWM2My1kNmY1MWI2YmExMDEiLCJpYXQiOjE3MDg5Mzk5MDcsImV4cCI6MTcxMTUzMTkwN30.BbIXGVkQOU2HqsiCg6UcwFZx-kBd7kdOP24kUD21c1M",BASE_URL:"/DreamBoost/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f}=st,et={data(){return{modalInstance:"",denyMessages:""}},methods:{show(){this.denyMessages="",this.modalInstance.show()},hide(){this.modalInstance.hide()},doubleCheck(){y.fire({title:"確定要退回提案嗎？",icon:"question",allowOutsideClick:!1,showCancelButton:!0,buttonsStyling:!0,confirmButtonText:"確認",cancelButtonText:"取消"}).then(s=>{s.isConfirmed&&this.denyProposal(),s.isDismissed}).catch(()=>{this.addToast({content:"退回提案過程出現錯誤",style:"error"})})},denyProposal(){this.showFullScreenLoading(),Promise.all([this.$http.post(`${f}/dreamboost/proposal/admin/changeToDraft`,{proposalID:this.denyProposalData.proposalID}),this.$http.post(`${f}/dreamboost/message/admin/message`,{messageToUserID:`${this.denyProposalData.proposalByUserID}`,messageTitle:"提案審核失敗",messageContent:`退回原因：${this.denyMessages}`,messageTime:new Date().getTime()})]).then(()=>{this.hideFullScreenLoading(),this.addToast({content:"已經提案退回",style:"info"}),this.hide(),this.$emit("updateProposalDatas")}).catch(s=>{this.hideFullScreenLoading(),this.addToast({content:"退回提案過程出現錯誤，請聯繫工程師",style:"error"}),console.log(s)})}},mounted(){this.modalInstance=new this.$bs.Modal(this.$refs.modalInstance,{focus:!1})},computed:{...E(M,["denyProposalData"])},components:{},watch:{},mixins:[v,I]},w=s=>(D("data-v-677b14f0"),s=s(),x(),s),ot={class:"modal fade",ref:"modalInstance","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",style:{"background-color":"rgba(11, 17, 28, 0.6)"}},at={class:"modal-dialog modal-lg modal-dialog-centered"},nt={class:"modal-content bg-gray-700 border border-light"},it={class:"modal-header border-bottom-0"},lt={class:"modal-body"},dt=w(()=>t("div",{class:"border-bottom"},[t("h2",{class:"mb-4 text-white fw-nromal text-center"},"退回專案"),t("p",{class:"mb-8 text-dark-pr text-center fs-18"},"請輸入退回原因")],-1)),rt={class:"mt-12 px-10"},ct={class:"card bg-transparent border-0"},pt={class:"card-body bg-transparent pt-3 pb-6 ps-8 pe-3 border-gray-500 border-bottom d-flex justify-content-between"},mt={class:"d-flex align-items-stretch"},ht=["src"],_t=w(()=>t("div",{class:"d-flex flex-column justify-content-center text-white"},[t("p",{class:"mb-0 fs-12 lh-sm mb-1"},"2024.02.13"),t("p",{class:"mb-0"},"小智的 MIT 夢 - 台灣學生的教育之旅")],-1)),ut={class:"modal-footer border-top-0"};function bt(s,e,a,h,d,o){return i(),l("div",ot,[t("div",at,[t("div",nt,[t("div",it,[t("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:e[0]||(e[0]=(...n)=>o.hide&&o.hide(...n))})]),t("div",lt,[dt,t("div",rt,[t("div",ct,[t("div",pt,[t("div",mt,[t("img",{src:s.denyProposalData.proposalMainImage,alt:"主要圖片",class:"rounded-pill me-10",width:"48",height:"48"},null,8,ht),_t])])]),U(t("textarea",{class:"form-control bg-transparent text-white mt-16",placeholder:"輸入退回原因",id:"",style:{height:"150px"},"onUpdate:modelValue":e[1]||(e[1]=n=>d.denyMessages=n)},null,512),[[L,d.denyMessages]])])]),t("div",ut,[t("button",{type:"button",class:"btn btn-dark-pr py-3 px-16",onClick:e[2]||(e[2]=(...n)=>o.doubleCheck&&o.doubleCheck(...n))},"儲存並關閉")])])])],512)}const gt=m(et,[["render",bt],["__scopeId","data-v-677b14f0"]]);var ft={VITE_URL:"https://api.dreamboost.shop",VITE_WEIKEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3RlbWFpbEBnbWFpbC5jb20iLCJ1c2VySUQiOiIzYTU4MjBhZi1iN2JlLTRkODMtOWM2My1kNmY1MWI2YmExMDEiLCJpYXQiOjE3MDg5Mzk5MDcsImV4cCI6MTcxMTUzMTkwN30.BbIXGVkQOU2HqsiCg6UcwFZx-kBd7kdOP24kUD21c1M",BASE_URL:"/DreamBoost/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:p}=ft,yt={data(){return{reviewProposals:[],activeProposals:[]}},methods:{showDenyProposalModal(){this.$refs.proposalModal.show()},getDatas(){this.showFullScreenLoading({canCancel:!1,loader:"dots"}),Promise.all([this.$http.get(`${p}/dreamboost/proposal/admin/inReviewProposals`),this.$http.get(`${p}/dreamboost/proposal/guest/inActiveProposals`)]).then(s=>{this.reviewProposals=s[0].data.data.result,this.activeProposals=s[1].data.data.result,this.addToast({content:"提案資料取得完畢"}),this.hideFullScreenLoading()}).catch(()=>{this.addToast({content:"取得API資料過程出現錯誤，請嘗試重新整理畫面再次取得。",style:"error"}),this.hideFullScreenLoading()})},activateProposal(s,e){y.fire({title:"確認審核？",text:`${e}`,footer:"注意，一旦審核通過即不可再修改狀態了。",icon:"question",allowOutsideClick:!1,showCancelButton:!0,buttonsStyling:!0,confirmButtonText:"確認",cancelButtonText:"取消"}).then(a=>a.isConfirmed?(this.showFullScreenLoading(),this.$http.post(`${p}/dreamboost/proposal/admin/changeToActive`,{proposalID:s})):a.isDismissed?Promise.reject(new Error("User cancelled")):Promise.reject(new Error("其他錯誤狀況"))).then(()=>{this.hideFullScreenLoading(),this.addToast({content:`${e} 已上架完成`}),this.getDatas()}).catch(a=>{this.hideFullScreenLoading(),a.message!=="User cancelled"&&this.addToast({content:"審核過程出現錯誤，請重新整理後再次操作。如果重複出現此提示請洽工程師。",style:"error"})})}},components:{ProposalCard:tt,ProposalModal:gt},mounted(){this.getDatas()},watched:{},mixins:[I,v]},k=s=>(D("data-v-a58eb1a4"),s=s(),x(),s),Dt={class:"container"},xt={class:"row justify-content-center"},vt={class:"col-12 col-lg-10"},It=k(()=>t("div",{class:"d-flex mb-4"},[t("p",{class:"mb-0 fs-3 text-white mt-19"},"待審查方案")],-1)),Mt={class:"l-CardGapY"},wt={class:"row justify-content-center"},kt={class:"col-12 col-lg-10"},$t=k(()=>t("div",{class:"d-flex mb-4"},[t("p",{class:"mb-0 fs-3 text-white mt-19"},"審查成功方案")],-1)),Pt={class:"l-CardGapY"};function Tt(s,e,a,h,d,o){const n=b("ProposalModal"),_=b("ProposalCard");return i(),l(c,null,[B(n,{ref:"proposalModal",onUpdateProposalDatas:o.getDatas},null,8,["onUpdateProposalDatas"]),t("div",Dt,[t("div",xt,[t("div",vt,[It,t("div",Mt,[(i(!0),l(c,null,u(d.reviewProposals,r=>(i(),g(_,{"proposal-data":r,key:r.proposalID,onEmitActive:o.activateProposal,onEmitDeny:o.showDenyProposalModal},null,8,["proposal-data","onEmitActive","onEmitDeny"]))),128))])])]),t("div",wt,[t("div",kt,[$t,t("div",Pt,[(i(!0),l(c,null,u(d.activeProposals,(r,$)=>(i(),g(_,{"proposal-data":r,key:`${$}-list`},null,8,["proposal-data"]))),128))])])])])],64)}const Ut=m(yt,[["render",Tt],["__scopeId","data-v-a58eb1a4"]]);export{Ut as default};
